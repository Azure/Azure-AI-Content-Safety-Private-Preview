

#  Ungroundedness Detection API Private Preview Documentation  ![informational](https://shields.io/badge/-PrivatePreview-PrivatePreview) 

The ungroundedness detection API is designed to identify instances of ungrounded information generated by GPTx or other large language models. Ungroundedness refers to situations where the model produces false or fictional information that does not align with user provided information and context. 

##  üóÉConcepts
Groundedness Definition
- Groundedness in LLMs refers to the degree to which the model's outputs are based on given information or how accurately the outputs reflect reliable sources.  A grounded response is the one that sticks closely to given information and avoids speculation or fabrication.  In groundedness measures, source information is required and serves as the grounding source.    

- Ungroundedness differs from hallucination in LLMs. Hallucination in LLMs refers to the generation of text that contains information that is fabricated, false, or misleading.  The definition of LLM hallucination varies among technical communities, but in general grounding source is optional rather than required for hallucination evaluation.

- Some LLM outputs could be non-hallucinated but ungrounded.  An example could be:
An online shopping platform ShopSphere had been implementing 30 days return policy for 3 years.  Recently ShopSphere introduced premium membership with $50 per year membership fee.  If a customer is a premium member, the customer has up to 180 days to return merchandise.

- If ShopSphere provides the most recent return policy and membership information, optimal LLM outputs would provide customized answers about the return policy based on the membership status (non-premium members for 30 days, versus premium member for 180 days).  These answers are both non-hallucinated and grounded. However, if the answer is simply 30 days for all members, the answer is ungrounded, but not necessarily hallucinated.

##  üóÉKey Features:
- Customizable Domains: Allows users to specify the domain (like medical, scientific, etc.) for more tailored detection based on the field‚Äôs specific needs.
- Task Specification: Supports different tasks like Questioning & Answering (QA) or Summarization, with adjustable settings according to the task type.
- Source Referencing: Utilizes an array of grounding sources (up to 10K characters) to compare the AI-generated text against established facts or data.
- Confidence Scoring: Provides a confidence score indicating the likelihood of ungrounded content.
- Detailed Reporting: Offers detailed insights into detected ungrounded segments, including the percentage of ungrounded content and specific instances of hallucinations.

## ‚ö†Ô∏è Disclaimer

The sample code may contain offensive content; user discretion is advised.


##  üìí Overview 

This documentation site is structured into following sections.

- **How It works** contains instructions for using the service in more general ways.
- **Scenarios** provides in-depth explanations of the senerios.
- **Sample Code** shows sample requests using the cURL, Python, C# and Java.
- **QuickStart** goes over getting-started instructions to guide you through making requests to the service.

  

##  üîéHow It works

- ### Type of analysis

| API             | Functionality                                                |
| :-------------- | :----------------------------------------------------------- |
| Ungroundedness Detection API | ‚Ä¢	Scanning: The API scans text generated by AI models, looking for segments that might be considered 'ungrounded' or not based on factual data.<br>‚Ä¢	Detection: Utilizes advanced algorithms to identify potential inaccuracies, fabrications, or hallucinations in the text.<br>‚Ä¢	Assessment of Groundedness: Evaluates how much of the content is based on real, verifiable sources versus what is potentially fabricated or speculative.<br>|

- ### Language availability

Currently this API supports only English languages.



##  üóÉScenarios

The current ungroundedness detection and mitigation function supports both text-based Summarization and Questioning & Answering (QA) tasks to ensure that the generated summaries or answers are accurate and reliable.  Here are some examples:

**Summarization Tasks**:  
‚Ä¢	News summarization: In the context of news articles, the function can be used to verify that the summary does not include fabricated or misleading information, ensuring that readers receive accurate and trustworthy information.<br>
‚Ä¢	Academic paper summarization: When generating summaries of academic papers or research articles, the function can help ensure that the summarized content accurately represents the key findings and contributions without introducing false claims.<br>
‚Ä¢	Legal document summarization: In legal environments, where summarizing lengthy legal documents is common, the function can confirm that the summary does not contain any erroneous statements or omissions that could lead to legal disputes.<br>

**Questioning & Answering (QA) Tasks**: <br>
‚Ä¢	Customer support chatbots: In customer support, the function can be used to validate the answers provided by AI chatbots, ensuring that customers receive accurate and trustworthy information when they ask questions about products or services.<br>
‚Ä¢	Legal queries: For legal QA systems, the function helps verify the accuracy of legal answers and advice provided by AI systems to lawyers and clients, reducing the risk of legal complications.<br>
‚Ä¢	Educational QA: In educational settings, the function can be applied to QA tasks to confirm that answers to academic questions or test prep queries are factually accurate, supporting the learning process.<br>
‚Ä¢	Financial and investment queries: For financial and investment-related questions, the function can validate the answers given by AI systems, helping users make informed financial decisions based on accurate information.<br>




## üí° QuickStart - Ungroundedness Detection Detection by using the API 

Before you can begin to test, you need to create an Azure AI Content Safety resource and get the subscription keys to access the resource.

> ###  üìò NOTE:
>
> The samples could contain offensive content, user discretion advised!!


### Step 1. Whitelist your subscription ID

1. Submit this form by filling your subscription ID to whitelist this feature to you: [Microsoft Forms](https://forms.office.com/r/38GYZwLC0u).
2. The whitelist will take up to 48 hours to approve. Once you receive notification from Microsoft, you can go to next step.

### Step 2. Create an Azure Content Safety resource

1. Sign in to the [Azure Portal](https://portal.azure.com/).
2. [Create Content Safety Resource](https://aka.ms/acs-create). Enter a unique name for your resource, select the **whitelisted subscription**, resource group, your preferred region in one of the **East US, West Europe** and pricing tier. Select **Create**.
3. **The resource will take a few minutes to deploy.** After it does, go to the new resource. To access your Content Safety resource, you'll need a subscription key; In the left pane, under **Resource Management**, select **API Keys and Endpoints**. Copy one of the subscription key values and endpoint for later use.

> ###  üìò NOTE:
>
> Currently the private preview features are only available in two regions:  **East US, West Europe**. Please create your Content Safety resource in these regions. Feel free to let us know your future production regions so we can plan accordingly.

### Step 3. Test with sample Request

Now that you have a resource available in Azure for Content Safety and you have a subscription key for that resource, let's run some tests by using the Ungroundedness Detection API.

#### Prepare a sample text and grounding sources 

Choose a sample text to analyze.

The maximum size for Text input is 1000 characters, and GroundingSources length should not exceed 10K characters.
#### **Request Format Reference**

1. Substitute the `<endpoint>` with your resource endpoint URL.
2. Replace `<your_subscription_key>` with your key.

```
curl --location '<Endpoint>contentsafety/text:detectUngroundedness?api-version=2023-11-30-preview' \
--header 'Ocp-Apim-Subscription-Key: <your_subscription_key>' \
--header 'Content-Type: application/json' \
--data '{
    "Task": "Summarization",
    "Text": "The sun rises from the west. In most cultures and scientific understanding, the sun rises in the west, traverses the sky throughout the day, and sets in the west. This is a result of the Earth'\''s rotation, which gives the impression of the sun'\''s apparent movement across the sky. However, in some ancient myths, legends, or cultural beliefs, there might exist different interpretations. ",
    "GroundingSources": [
        "The sun rises from the east due to the visual effect caused by the Earth'\''s rotation. The rotation of the Earth creates the illusion of the sun rising from the horizon. In reality, it'\''s because we stand on the Earth'\''s surface, rotating from west to east at a speed of approximately 1670 kilometers per hour, which causes the movement of the sun across the sky. The Earth'\''s rotation leads to the alternation of day and night, and the sunrise from the east is just a part of this cycle"
    ]
}'
```

| Name                   | Description                                                  | Type    |
| :--------------------- | :----------------------------------------------------------- | ------- |
| **domain** | (Optional)  Medical, Generic, default is Generic. | Enum  |
| **task**               | (Optional) Type of task: QnA, Summarization, default value: Summarization. | Enum |
| **query**               | (Optional) This parameter will only be used when the task type is QnA, required when task type is QnA.Character Limit: Restrictions on the amount of query that can be analyzed in a single request is 1K characters to ensure efficient processing. | String  |
| **text**          | (Required)The specific text that need to be checked.1K characters maximum.Character Limit: Restrictions on the amount of text that can be analyzed in a single request is 1K characters to ensure efficient processing.|  String  |
| **groundingSources**         | (Required) Sources to ground the AI content.Character Limit: Restrictions on the amount of grounding sources that can be analyzed in a single request is 10K charcaters to ensure efficient processing. | String array    |
| **gptResources**         | (Optional) Details about the GPT resources used. See below table. | String   |


GPTResource
| Name                   | Description                                                  | Type    |
| :--------------------- | :----------------------------------------------------------- | ------- |
| **azureOpenAIEndpoint** | (Required)  Endpoint for Azure's OpenAI service.  | String |
| **deploymentName** | (Required) Name of the specific deployment. | String|



#### **Response Format Reference**

```json
{
    "ungrounded": true,
    "confidenceScore": 1,
    "ungroundedPercentage": 0.5,
    "ungroundedDetails": [
        {
            "text": "The sun rises from the west.",
            "reason": "\"The sun rises from the east due to the visual effect caused by the Earth's rotation.\" The hypothesis contradicts the premise. "
        },
        {
            "text": "In most cultures and scientific understanding, the sun rises in the west, traverses the sky throughout the day, and sets in the west.",
            "reason": "\"The sun rises from the east due to the visual effect caused by the Earth's rotation.\" The hypothesis contradicts the premise. "
        }
    ]
}
   
```


| Name                | Description                                                  | Type    |
| :------------------ | :----------------------------------------------------------- | ------- |
| **ungrounded**        | (Required) The model assesses whether this text belongs to hallucination.  | Boolean    |
| **confidenceScore** | (Required) The meaning of the 'score' is the likelihood that the ungrounded prediction is correct.	 | Float	 |
| **ungroundedPercentage** | (Required) The percentage of the text considered ungrounded or hallucinated. | Float	 |
| **ungroundedDetails** | (Optional) Provides detailed occurrences of hallucinations within the content. | String |


UngroundedDetails
| Name                | Description                                                  | Type    |
| :------------------ | :----------------------------------------------------------- | ------- |
| **Text**        | (Optional) The specific text that is ungrounded.  | String   |
| **Reason** | (Optional) The reason for the hallucination, depending on the GPT resources used. | String  |



## üí° QuickStart - Ungroundedness Detection by using Studio

 ##  üìù Other Sample Code 
- #### Python

Here is a sample request with Python. 

```Python
import http.client
import json

conn = http.client.HTTPSConnection("<Endpoint>")
payload = json.dumps({
  "Domain": "GENERIC",
  "Task": "qna",
  "Query": "test",
  "Text": "The sun rises from the west. In most cultures and scientific understanding, the sun rises in the west, traverses the sky throughout the day, and sets in the west. This is a result of the Earth's rotation, which gives the impression of the sun's apparent movement across the sky. However, in some ancient myths, legends, or cultural beliefs, there might exist different interpretations. ",
  "GroundingSources": [
    "The sun rises from the east due to the visual effect caused by the Earth's rotation. The rotation of the Earth creates the illusion of the sun rising from the horizon. In reality, it's because we stand on the Earth's surface, rotating from west to east at a speed of approximately 1670 kilometers per hour, which causes the movement of the sun across the sky. The Earth's rotation leads to the alternation of day and night, and the sunrise from the east is just a part of this cycle"
  ],
  "RuntimeOptions": {
    "DetectMode": "test"
  }
})
headers = {
  'Ocp-Apim-Subscription-Key': '<your_subscription_key>',
  'Content-Type': 'application/json'
}
conn.request("POST", "/contentsafety/text:detectUngroundedness?api-version=2023-11-30-preview", payload, headers)
res = conn.getresponse()
data = res.read()
print(data.decode("utf-8"))

```

- #### C#

Here is a sample request with C#. 

```c#
var client = new HttpClient();
var request = new HttpRequestMessage(HttpMethod.Post, "<Endpoint>contentsafety/text:detectUngroundedness?api-version=2023-11-30-preview");
request.Headers.Add("Ocp-Apim-Subscription-Key", "<your_subscription_key>");
var content = new StringContent("{\r\n    \"Domain\": \"GENERIC\",\r\n    \"Task\": \"qna\",\r\n    \"Query\": \"test\",\r\n    \"Text\": \"The sun rises from the west. In most cultures and scientific understanding, the sun rises in the west, traverses the sky throughout the day, and sets in the west. This is a result of the Earth's rotation, which gives the impression of the sun's apparent movement across the sky. However, in some ancient myths, legends, or cultural beliefs, there might exist different interpretations. \",\r\n    \"GroundingSources\": [\r\n        \"The sun rises from the east due to the visual effect caused by the Earth's rotation. The rotation of the Earth creates the illusion of the sun rising from the horizon. In reality, it's because we stand on the Earth's surface, rotating from west to east at a speed of approximately 1670 kilometers per hour, which causes the movement of the sun across the sky. The Earth's rotation leads to the alternation of day and night, and the sunrise from the east is just a part of this cycle\"\r\n    ],\r\n    \"RuntimeOptions\" : {\r\n        \"DetectMode\" : \"test\"\r\n    }\r\n}", null, "application/json");
request.Content = content;
var response = await client.SendAsync(request);
response.EnsureSuccessStatusCode();
Console.WriteLine(await response.Content.ReadAsStringAsync());


```

- #### Java

Here is a sample request with Java. 

```java
OkHttpClient client = new OkHttpClient().newBuilder()
  .build();
MediaType mediaType = MediaType.parse("application/json");
RequestBody body = RequestBody.create(mediaType, "{\r\n    \"Domain\": \"GENERIC\",\r\n    \"Task\": \"qna\",\r\n    \"Query\": \"test\",\r\n    \"Text\": \"The sun rises from the west. In most cultures and scientific understanding, the sun rises in the west, traverses the sky throughout the day, and sets in the west. This is a result of the Earth's rotation, which gives the impression of the sun's apparent movement across the sky. However, in some ancient myths, legends, or cultural beliefs, there might exist different interpretations. \",\r\n    \"GroundingSources\": [\r\n        \"The sun rises from the east due to the visual effect caused by the Earth's rotation. The rotation of the Earth creates the illusion of the sun rising from the horizon. In reality, it's because we stand on the Earth's surface, rotating from west to east at a speed of approximately 1670 kilometers per hour, which causes the movement of the sun across the sky. The Earth's rotation leads to the alternation of day and night, and the sunrise from the east is just a part of this cycle\"\r\n    ],\r\n    \"RuntimeOptions\" : {\r\n        \"DetectMode\" : \"test\"\r\n    }\r\n}");
Request request = new Request.Builder()
  .url("<Endpoint>/contentsafety/text:detectUngroundedness?api-version=2023-11-30-preview")
  .method("POST", body)
  .addHeader("Ocp-Apim-Subscription-Key", "<your_subscription_key>")
  .addHeader("Content-Type", "application/json")
  .build();
Response response = client.newCall(request).execute();
```



##  üìí Key Reference 

- [Content Safety Doc](https://aka.ms/acs-doc)




##  üí¨ We're here to help!

If you get stuck, [shoot us an email](mailto:contentsafetysupport@microsoft.com) or use the feedback widget on the upper right of any page.

We're excited you're here! 


